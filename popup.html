<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Detector</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div class="container">
    <!-- Main View -->
    <div id="mainView">
      <header>
        <div class="item">
          <button id="settingsButton" class="action-button settings-button" title="Settings">
            <i class="fas fa-cog"></i>
          </button>
          <h1>API Detector</h1>

          <div class="toggle-container">
            <label class="switch">
              <input type="checkbox" id="siteToggle">
              <span class="slider round"></span>
            </label>
            <span id="siteToggleLabel"></span>
          </div>
        </div>
        <div class="item">
          <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search logs...">

          </div>
        </div>

      </header>

      <div class="logs-container">
        <div class="logs-header">
          <h2>Detected Api</h2>
          <div class="button-group">
            <button id="refreshButton" title="Refresh Logs" class="action-button">
              <i class="fas fa-sync-alt"></i>
              <span>Refresh</span>
            </button>
            <button id="clearAllButton" title="Clear All Logs" class="action-button clear-button">
              <i class="fas fa-trash-alt"></i>
              <span>Clear All</span>
            </button>
          </div>
        </div>
        <div id="logsCount">Loading...</div>
        <div id="logsList"></div>
      </div>

      <div class="gemini-container">
        <h2>Ask Gemini</h2>
        <div class="gemini-input">
          <textarea id="questionInput" placeholder="find api for some thing..." rows="4"></textarea>
          <div class="button-group">
            <button id="askButton" title="Ask Gemini" class="action-button ask-button">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
        <div id="answerContainer" class="hidden">
          <h3>Gemini's' Answer:</h3>
          <div id="answerText"></div>
        </div>
        <div class="author-text">
          <p>Powered by nghe.huavan@gmail.com</p>
        </div>
      </div>
    </div>

    <!-- Settings View -->
    <div id="settingsView" class="hidden">
      <header>
        <h1>Gemini Settings</h1>
        <button id="backButton" class="action-button back-button" title="Back to main view">
          <i class="fas fa-arrow-left"></i>
          <span>Back</span>
        </button>
      </header>

      <div class="settings-container">
        <div class="setting-group">
          <h2>API Provider</h2>
          <p class="description">Select the API provider to use for AI analysis.</p>
          <select id="apiProviderSelect">
            <option value="gemini">Google Gemini</option>
            <option value="openrouter">OpenRouter</option>
          </select>
        </div>

        <div id="geminiSettings" class="setting-group">
          <h2>Google Gemini API Key</h2>
          <p class="description">
            Enter your Google Gemini API key to enable AI analysis of JSON responses.
            <a href="https://aistudio.google.com" target="_blank">Get an API key</a>
          </p>
          <div class="api-key-controls">
            <input type="password" id="apiKeyInput" placeholder="Enter your Gemini API key">
            <button id="toggleGeminiVisibility" title="Toggle visibility" class="toggle-visibility-button">
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>

        <div id="openrouterSettings" class="setting-group hidden">
          <h2>OpenRouter API Key</h2>
          <p class="description">
            Enter your OpenRouter API key to enable AI analysis of JSON responses.
            <a href="https://openrouter.ai/keys" target="_blank">Get an API key</a>
          </p>
          <div class="api-key-controls">
            <input type="password" id="openrouterApiKeyInput" placeholder="Enter your OpenRouter API key">
            <button id="toggleOpenRouterVisibility" title="Toggle visibility" class="toggle-visibility-button">
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>

        <div class="button-group">
          <button id="saveButton" class="primary-button">Save Settings</button>
          <button id="clearSettingsButton" class="secondary-button">Clear Settings</button>
        </div>

        <div id="statusMessage" class="status-message"></div>
      </div>

      <div class="setting-group">
        <h2>About</h2>
        <p>Captures HTTP responses on webpages, filters and saves JSON responses, and allows you to ask the data using Google Gemini AI.</p>
        <p>Version: 1.0</p>
        <p>Author: nghe.huavan@gmail.com</p>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>

</html>